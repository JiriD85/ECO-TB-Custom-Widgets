{
  "fqn": "eco_custom_widgets.eco_timeseries_zoom_sync",
  "name": "ECO Timeseries Zoom Sync",
  "deprecated": false,
  "image": "tb-image;/api/images/system/chart.svg",
  "description": "Time series visualization with configurable chart types (line, bar, area, scatter), multi-series support, dual Y-axes, statistics cards, and internal zoom. Reference implementation for ECO Custom Widgets.",
  "descriptor": {
    "type": "timeseries",
    "sizeX": 8,
    "sizeY": 5,
    "resources": [
      {
        "url": "https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"
      }
    ],
    "templateHtml": "<div id=\"widget-wrapper\" style=\"width: 100%; height: 100%; display: flex; flex-direction: column;\">\n  <div id=\"timewindow-selector\" style=\"display: none;\"></div>\n  <div id=\"stats-card-top\" style=\"padding: 4px 8px; display: none;\"></div>\n  <div style=\"flex: 1; min-height: 0; display: flex;\">\n    <div id=\"stats-card-left\" style=\"padding: 4px; display: none;\"></div>\n    <div id=\"chart-container\" style=\"flex: 1; min-height: 0;\"></div>\n    <div id=\"stats-card-right\" style=\"padding: 4px; display: none;\"></div>\n  </div>\n  <div id=\"stats-card-bottom\" style=\"padding: 4px 8px; display: none;\"></div>\n</div>",
    "templateCss": "#widget-wrapper { position: relative; }\n#chart-container { position: relative; }",
    "controllerScript": "/**\n * ECO Timeseries Zoom Sync Widget\n *\n * Time series visualization with configurable chart types, multi-series support,\n * dual Y-axes, statistics cards, and timewindow selector.\n */\n\nvar chart = null;\nvar chartContainer = null;\nvar statsCardContainers = {};\nvar timewindowContainer = null;\nvar resizeObserver = null;\n\n// Timewindow Selector State\nvar twState = {\n    mode: 'custom',      // 'day', 'week', 'month', 'custom'\n    currentDate: new Date(),\n    customStart: null,   // User-selected start (via datepicker)\n    customEnd: null      // User-selected end (via datepicker)\n};\n\n// ========================================\n// Initialization\n// ========================================\nself.onInit = function() {\n    chartContainer = self.ctx.$container.find('#chart-container')[0];\n    timewindowContainer = self.ctx.$container.find('#timewindow-selector')[0];\n    statsCardContainers = {\n        top: self.ctx.$container.find('#stats-card-top')[0],\n        bottom: self.ctx.$container.find('#stats-card-bottom')[0],\n        left: self.ctx.$container.find('#stats-card-left')[0],\n        right: self.ctx.$container.find('#stats-card-right')[0]\n    };\n\n    if (!chartContainer) {\n        console.error('ECO Timeseries: Chart container not found');\n        return;\n    }\n\n    if (typeof echarts === 'undefined') {\n        console.error('ECO Timeseries: ECharts not loaded');\n        return;\n    }\n\n    chart = echarts.init(chartContainer);\n\n    // Initialize timewindow selector\n    initTimewindowSelector();\n\n    updateChart();\n\n    // Resize handling\n    [100, 250, 500, 1000].forEach(function(delay) {\n        setTimeout(function() {\n            if (chart && chartContainer) {\n                chart.resize({ width: chartContainer.offsetWidth, height: chartContainer.offsetHeight });\n            }\n        }, delay);\n    });\n\n    if (typeof ResizeObserver !== 'undefined') {\n        resizeObserver = new ResizeObserver(function() {\n            requestAnimationFrame(function() {\n                if (chart && chartContainer) {\n                    chart.resize({ width: chartContainer.offsetWidth, height: chartContainer.offsetHeight });\n                }\n            });\n        });\n        resizeObserver.observe(chartContainer);\n    }\n};\n\nself.onDataUpdated = function() {\n    updateChart();\n};\n\nself.onResize = function() {\n    if (chart && chartContainer) {\n        chart.resize({ width: chartContainer.offsetWidth, height: chartContainer.offsetHeight });\n    }\n};\n\nself.onDestroy = function() {\n    if (resizeObserver) {\n        resizeObserver.disconnect();\n        resizeObserver = null;\n    }\n    if (chart) {\n        chart.dispose();\n        chart = null;\n    }\n};\n\n// ========================================\n// Timewindow Selector\n// ========================================\nfunction initTimewindowSelector() {\n    var settings = self.ctx.settings || {};\n\n    // Set initial mode from settings\n    twState.mode = settings.twSelectorDefaultMode || 'custom';\n    twState.currentDate = new Date();\n\n    // Apply initial timewindow based on settings\n    if (settings.twCustomStartTime) {\n        // If custom start time is configured, apply it on init\n        applyTimewindow();\n    }\n}\n\nfunction renderTimewindowSelector() {\n    if (!timewindowContainer) return;\n\n    var settings = self.ctx.settings || {};\n    var showSelector = settings.showTimewindowSelector === true;\n\n    if (!showSelector) {\n        timewindowContainer.style.display = 'none';\n        return;\n    }\n\n    // Clear container\n    while (timewindowContainer.firstChild) {\n        timewindowContainer.removeChild(timewindowContainer.firstChild);\n    }\n\n    // Determine accent color\n    var accentColor = settings.twSelectorColor || '#2196F3';\n    if (!settings.twSelectorColor && self.ctx.data && self.ctx.data[0] && self.ctx.data[0].dataKey) {\n        accentColor = self.ctx.data[0].dataKey.color || '#2196F3';\n    }\n\n    // Position\n    var positionMap = { left: 'flex-start', center: 'center', right: 'flex-end' };\n    var position = settings.twSelectorPosition || 'center';\n\n    timewindowContainer.style.display = 'flex';\n    timewindowContainer.style.alignItems = 'center';\n    timewindowContainer.style.justifyContent = positionMap[position] || 'center';\n    timewindowContainer.style.padding = '8px';\n\n    // Main wrapper\n    var wrapper = document.createElement('div');\n    wrapper.style.cssText = 'display: flex; align-items: center; gap: 6px; background: ' + accentColor + '; border-radius: 6px; padding: 6px 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.12);';\n\n    // Navigation buttons (only for D, W, M)\n    if (twState.mode !== 'custom') {\n        var navLeft = createButton('â—€', function() { navigate(-1); });\n        wrapper.appendChild(navLeft);\n    }\n\n    // Mode buttons\n    var btnContainer = document.createElement('div');\n    btnContainer.style.cssText = 'display: flex; gap: 4px;';\n\n    var modes = [\n        { id: 'day', label: 'D', title: 'Tag' },\n        { id: 'week', label: 'W', title: 'Woche' },\n        { id: 'month', label: 'M', title: 'Monat' },\n        { id: 'custom', label: 'C', title: 'Custom' }\n    ];\n\n    modes.forEach(function(m) {\n        var isActive = twState.mode === m.id;\n        var btn = document.createElement('button');\n        btn.textContent = m.label;\n        btn.title = m.title;\n        btn.style.cssText = 'border: none; width: 28px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600; transition: all 0.2s;';\n\n        if (isActive) {\n            btn.style.background = 'white';\n            btn.style.color = accentColor;\n        } else {\n            btn.style.background = 'rgba(255,255,255,0.2)';\n            btn.style.color = 'white';\n        }\n\n        btn.onmouseover = function() {\n            if (!isActive) btn.style.background = 'rgba(255,255,255,0.35)';\n        };\n        btn.onmouseout = function() {\n            if (!isActive) btn.style.background = 'rgba(255,255,255,0.2)';\n        };\n        btn.onclick = function() { selectMode(m.id); };\n\n        btnContainer.appendChild(btn);\n    });\n\n    wrapper.appendChild(btnContainer);\n\n    // Navigation buttons (only for D, W, M)\n    if (twState.mode !== 'custom') {\n        var navRight = createButton('â–¶', function() { navigate(1); });\n        wrapper.appendChild(navRight);\n    }\n\n    // Label\n    var label = document.createElement('span');\n    label.style.cssText = 'color: white; font-size: 11px; margin-left: 8px; opacity: 0.9;';\n    label.textContent = formatLabel();\n    wrapper.appendChild(label);\n\n    // Calendar button for custom mode\n    if (twState.mode === 'custom') {\n        var calBtn = createButton('ðŸ“…', function(e) {\n            e.stopPropagation();\n            showDatePicker(wrapper, accentColor);\n        });\n        calBtn.title = 'Zeitraum wÃ¤hlen';\n        calBtn.style.marginLeft = '4px';\n        wrapper.appendChild(calBtn);\n    }\n\n    timewindowContainer.appendChild(wrapper);\n}\n\nfunction createButton(text, onClick) {\n    var btn = document.createElement('button');\n    btn.textContent = text;\n    btn.style.cssText = 'background: rgba(255,255,255,0.2); border: none; color: white; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 10px; display: flex; align-items: center; justify-content: center; transition: background 0.2s;';\n    btn.onmouseover = function() { btn.style.background = 'rgba(255,255,255,0.35)'; };\n    btn.onmouseout = function() { btn.style.background = 'rgba(255,255,255,0.2)'; };\n    btn.onclick = onClick;\n    return btn;\n}\n\nfunction selectMode(mode) {\n    twState.mode = mode;\n    if (mode !== 'custom') {\n        twState.currentDate = new Date();\n        twState.customStart = null;\n        twState.customEnd = null;\n    }\n    applyTimewindow();\n    renderTimewindowSelector();\n}\n\nfunction navigate(direction) {\n    var d = new Date(twState.currentDate);\n\n    switch (twState.mode) {\n        case 'day':\n            d.setDate(d.getDate() + direction);\n            break;\n        case 'week':\n            d.setDate(d.getDate() + (direction * 7));\n            break;\n        case 'month':\n            d.setMonth(d.getMonth() + direction);\n            break;\n    }\n\n    twState.currentDate = d;\n    applyTimewindow();\n    renderTimewindowSelector();\n}\n\nfunction applyTimewindow() {\n    var range = calculateRange();\n    if (!range) return;\n\n    var settings = self.ctx.settings || {};\n\n    var timewindow = {\n        history: {\n            fixedTimewindow: { startTimeMs: range.start, endTimeMs: range.end },\n            historyType: 0\n        },\n        aggregation: {\n            type: settings.twAggregationType || 'NONE',\n            limit: settings.twMaxDataPoints || 100000\n        }\n    };\n\n    var useDashboardTw = self.ctx.widget && self.ctx.widget.config ?\n        self.ctx.widget.config.useDashboardTimewindow : true;\n\n    if (useDashboardTw !== false) {\n        if (self.ctx.dashboard && self.ctx.dashboard.updateDashboardTimewindow) {\n            self.ctx.dashboard.updateDashboardTimewindow(timewindow);\n        } else if (self.ctx.dashboard && self.ctx.dashboard.onUpdateTimewindow) {\n            self.ctx.dashboard.onUpdateTimewindow(range.start, range.end);\n        }\n    } else {\n        if (self.ctx.timewindowFunctions && self.ctx.timewindowFunctions.onUpdateTimewindow) {\n            self.ctx.timewindowFunctions.onUpdateTimewindow(range.start, range.end);\n        }\n    }\n}\n\nfunction calculateRange() {\n    var settings = self.ctx.settings || {};\n    var d = new Date(twState.currentDate);\n    var start, end;\n\n    switch (twState.mode) {\n        case 'day':\n            start = new Date(d.getFullYear(), d.getMonth(), d.getDate(), 0, 0, 0, 0);\n            end = new Date(d.getFullYear(), d.getMonth(), d.getDate(), 23, 59, 59, 999);\n            break;\n\n        case 'week':\n            var dayOfWeek = d.getDay();\n            var diffToMonday = (dayOfWeek === 0 ? -6 : 1) - dayOfWeek;\n            var monday = new Date(d);\n            monday.setDate(d.getDate() + diffToMonday);\n            start = new Date(monday.getFullYear(), monday.getMonth(), monday.getDate(), 0, 0, 0, 0);\n            var sunday = new Date(monday);\n            sunday.setDate(monday.getDate() + 6);\n            end = new Date(sunday.getFullYear(), sunday.getMonth(), sunday.getDate(), 23, 59, 59, 999);\n            break;\n\n        case 'month':\n            start = new Date(d.getFullYear(), d.getMonth(), 1, 0, 0, 0, 0);\n            end = new Date(d.getFullYear(), d.getMonth() + 1, 0, 23, 59, 59, 999);\n            break;\n\n        case 'custom':\n            // Priority: 1) User-selected via datepicker, 2) Settings, 3) Dashboard TW (no change)\n            if (twState.customStart && twState.customEnd) {\n                return { start: twState.customStart, end: twState.customEnd };\n            }\n\n            if (settings.twCustomStartTime) {\n                var startMs = resolveTimeValue(settings.twCustomStartTime);\n                var endMs = settings.twCustomEndTime ? resolveTimeValue(settings.twCustomEndTime) : Date.now();\n                if (startMs) {\n                    return { start: startMs, end: endMs || Date.now() };\n                }\n            }\n\n            // No custom settings - don't change timewindow\n            return null;\n    }\n\n    return { start: start.getTime(), end: end.getTime() };\n}\n\nfunction resolveTimeValue(valueStr) {\n    if (!valueStr || valueStr === '') return null;\n\n    // Check for ${attribute} pattern\n    var varMatch = valueStr.match(/^\\$\\{(.+)\\}$/);\n    if (varMatch) {\n        var attrName = varMatch[1];\n        if (self.ctx.datasources && self.ctx.datasources[0]) {\n            var ds = self.ctx.datasources[0];\n            if (ds.entity && ds.entity.attributes && ds.entity.attributes[attrName] !== undefined) {\n                return Number(ds.entity.attributes[attrName]);\n            }\n        }\n        if (self.ctx.latestData) {\n            for (var i = 0; i < self.ctx.latestData.length; i++) {\n                var ld = self.ctx.latestData[i];\n                if (ld.dataKey && ld.dataKey.name === attrName && ld.data && ld.data.length > 0) {\n                    return Number(ld.data[ld.data.length - 1][1]);\n                }\n            }\n        }\n        return null;\n    }\n\n    // Try as number (timestamp)\n    var numVal = Number(valueStr);\n    if (!isNaN(numVal) && numVal > 0) return numVal;\n\n    // Try as date string\n    var dateVal = Date.parse(valueStr);\n    if (!isNaN(dateVal)) return dateVal;\n\n    return null;\n}\n\nfunction formatLabel() {\n    var settings = self.ctx.settings || {};\n    var d = twState.currentDate;\n\n    switch (twState.mode) {\n        case 'day':\n            return formatDate(d, settings.twSelectorDayFormat || 'DD.MM.YYYY');\n\n        case 'week':\n            var range = calculateRange();\n            if (range) {\n                var startD = new Date(range.start);\n                var endD = new Date(range.end);\n                var fmt = settings.twSelectorWeekFormat || 'DD.MM.YYYY - DD.MM.YYYY';\n                if (fmt.indexOf(' - ') !== -1) {\n                    var parts = fmt.split(' - ');\n                    return formatDate(startD, parts[0]) + ' - ' + formatDate(endD, parts[1] || parts[0]);\n                }\n                return formatDate(startD, 'DD.MM.YYYY') + ' - ' + formatDate(endD, 'DD.MM.YYYY');\n            }\n            return '';\n\n        case 'month':\n            return formatDate(d, settings.twSelectorMonthFormat || 'MMMM YYYY');\n\n        case 'custom':\n            if (twState.customStart && twState.customEnd) {\n                return formatDate(new Date(twState.customStart), 'DD.MM.YY') + ' - ' +\n                       formatDate(new Date(twState.customEnd), 'DD.MM.YY');\n            }\n            if (self.ctx.dashboard && self.ctx.dashboard.dashboardTimewindow) {\n                var tw = self.ctx.dashboard.dashboardTimewindow;\n                if (tw.history && tw.history.fixedTimewindow) {\n                    return formatDate(new Date(tw.history.fixedTimewindow.startTimeMs), 'DD.MM.YY') + ' - ' +\n                           formatDate(new Date(tw.history.fixedTimewindow.endTimeMs), 'DD.MM.YY');\n                }\n            }\n            return 'Dashboard';\n    }\n    return '';\n}\n\nfunction formatDate(date, format) {\n    var monthsShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n    var monthsFull = ['Januar', 'Februar', 'MÃ¤rz', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];\n    var d = new Date(date);\n\n    format = format || 'DD.MM.YYYY';\n\n    return format\n        .replace('YYYY', d.getFullYear())\n        .replace('YY', String(d.getFullYear()).slice(-2))\n        .replace('MMMM', monthsFull[d.getMonth()])\n        .replace('MMM', monthsShort[d.getMonth()])\n        .replace('MM', String(d.getMonth() + 1).padStart(2, '0'))\n        .replace('DD', String(d.getDate()).padStart(2, '0'))\n        .replace(/D(?!e)/g, String(d.getDate()));\n}\n\nfunction showDatePicker(anchor, accentColor) {\n    // Remove existing picker\n    var existing = document.getElementById('eco-tw-datepicker');\n    if (existing) {\n        existing.remove();\n        return;\n    }\n\n    // Get current dates\n    var startDate = new Date();\n    var endDate = new Date();\n    startDate.setDate(startDate.getDate() - 7);\n\n    if (twState.customStart && twState.customEnd) {\n        startDate = new Date(twState.customStart);\n        endDate = new Date(twState.customEnd);\n    } else if (self.ctx.dashboard && self.ctx.dashboard.dashboardTimewindow) {\n        var tw = self.ctx.dashboard.dashboardTimewindow;\n        if (tw.history && tw.history.fixedTimewindow) {\n            startDate = new Date(tw.history.fixedTimewindow.startTimeMs);\n            endDate = new Date(tw.history.fixedTimewindow.endTimeMs);\n        }\n    }\n\n    function toInputDate(d) {\n        return d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0');\n    }\n\n    // Create picker\n    var picker = document.createElement('div');\n    picker.id = 'eco-tw-datepicker';\n    picker.style.cssText = 'position: absolute; top: 100%; left: 50%; transform: translateX(-50%); margin-top: 4px; background: white; border-radius: 8px; padding: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.25); z-index: 10000; min-width: 280px;';\n\n    // Title\n    var title = document.createElement('div');\n    title.style.cssText = 'font-size: 12px; font-weight: 600; color: #333; margin-bottom: 10px;';\n    title.textContent = 'Zeitraum wÃ¤hlen';\n    picker.appendChild(title);\n\n    // Inputs row\n    var inputsRow = document.createElement('div');\n    inputsRow.style.cssText = 'display: flex; gap: 8px;';\n\n    // Start\n    var startDiv = document.createElement('div');\n    startDiv.style.cssText = 'flex: 1;';\n    var startLabel = document.createElement('label');\n    startLabel.style.cssText = 'font-size: 10px; color: #666; display: block; margin-bottom: 2px;';\n    startLabel.textContent = 'Von';\n    var startInput = document.createElement('input');\n    startInput.type = 'date';\n    startInput.value = toInputDate(startDate);\n    startInput.style.cssText = 'width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; box-sizing: border-box;';\n    startDiv.appendChild(startLabel);\n    startDiv.appendChild(startInput);\n    inputsRow.appendChild(startDiv);\n\n    // End\n    var endDiv = document.createElement('div');\n    endDiv.style.cssText = 'flex: 1;';\n    var endLabel = document.createElement('label');\n    endLabel.style.cssText = 'font-size: 10px; color: #666; display: block; margin-bottom: 2px;';\n    endLabel.textContent = 'Bis';\n    var endInput = document.createElement('input');\n    endInput.type = 'date';\n    endInput.value = toInputDate(endDate);\n    endInput.style.cssText = 'width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; box-sizing: border-box;';\n    endDiv.appendChild(endLabel);\n    endDiv.appendChild(endInput);\n    inputsRow.appendChild(endDiv);\n\n    picker.appendChild(inputsRow);\n\n    // Buttons\n    var btnRow = document.createElement('div');\n    btnRow.style.cssText = 'display: flex; gap: 6px; justify-content: flex-end; margin-top: 10px;';\n\n    var cancelBtn = document.createElement('button');\n    cancelBtn.textContent = 'Abbrechen';\n    cancelBtn.style.cssText = 'padding: 6px 12px; border: 1px solid #ddd; background: white; border-radius: 4px; font-size: 11px; cursor: pointer;';\n    cancelBtn.onclick = function(e) { e.stopPropagation(); picker.remove(); };\n\n    var applyBtn = document.createElement('button');\n    applyBtn.textContent = 'Anwenden';\n    applyBtn.style.cssText = 'padding: 6px 12px; border: none; background: ' + accentColor + '; color: white; border-radius: 4px; font-size: 11px; cursor: pointer; font-weight: 500;';\n    applyBtn.onclick = function(e) {\n        e.stopPropagation();\n        var newStart = new Date(startInput.value);\n        var newEnd = new Date(endInput.value);\n        newEnd.setHours(23, 59, 59, 999);\n\n        twState.customStart = newStart.getTime();\n        twState.customEnd = newEnd.getTime();\n\n        applyTimewindow();\n        picker.remove();\n        renderTimewindowSelector();\n    };\n\n    btnRow.appendChild(cancelBtn);\n    btnRow.appendChild(applyBtn);\n    picker.appendChild(btnRow);\n\n    anchor.style.position = 'relative';\n    anchor.appendChild(picker);\n\n    // Close on outside click\n    setTimeout(function() {\n        document.addEventListener('click', function closeHandler(e) {\n            if (!picker.contains(e.target)) {\n                picker.remove();\n                document.removeEventListener('click', closeHandler);\n            }\n        });\n    }, 100);\n}\n\n// ========================================\n// Chart Update\n// ========================================\nfunction updateChart() {\n    if (!chart) return;\n\n    var settings = self.ctx.settings || {};\n    var data = self.ctx.data || [];\n\n    // Render timewindow selector\n    renderTimewindowSelector();\n\n    // Chart settings\n    var chartType = settings.chartType || 'line';\n    var smoothLine = settings.smoothLine !== false;\n    var showDataZoomSlider = settings.showDataZoomSlider !== false;\n    var showToolbox = settings.showToolbox !== false;\n    var toolboxFeatures = settings.toolboxFeatures || ['saveAsImage', 'dataView', 'dataZoom', 'restore'];\n\n    if (!data.length) {\n        showNoData('No data available');\n        return;\n    }\n\n    // Process series\n    var seriesConfigs = [];\n    var defaultColors = ['#2196F3', '#4CAF50', '#FF9800', '#E91E63', '#9C27B0', '#00BCD4'];\n\n    for (var i = 0; i < data.length; i++) {\n        var ds = data[i];\n        if (!ds.data || !ds.data.length) continue;\n\n        var dataKey = ds.dataKey || {};\n        var label = dataKey.label || dataKey.name || 'Series ' + (i + 1);\n        var color = dataKey.color || defaultColors[i % defaultColors.length];\n        var units = dataKey.units || '';\n\n        var seriesData = [];\n        for (var j = 0; j < ds.data.length; j++) {\n            var ts = ds.data[j][0];\n            var val = ds.data[j][1];\n            if (val !== null && !isNaN(val)) {\n                seriesData.push([ts, val]);\n            }\n        }\n\n        if (seriesData.length === 0) continue;\n\n        seriesConfigs.push({\n            label: label,\n            color: color,\n            units: units,\n            data: seriesData\n        });\n    }\n\n    if (seriesConfigs.length === 0) {\n        showNoData('No valid data');\n        return;\n    }\n\n    // Build option\n    var series = seriesConfigs.map(function(sc) {\n        var s = {\n            name: sc.label,\n            type: chartType === 'bar' ? 'bar' : 'line',\n            data: sc.data,\n            smooth: smoothLine && chartType === 'line',\n            symbol: chartType === 'line' ? 'none' : undefined,\n            lineStyle: { color: sc.color, width: 2 },\n            itemStyle: { color: sc.color }\n        };\n        if (chartType === 'area') {\n            s.areaStyle = { color: sc.color, opacity: 0.3 };\n        }\n        return s;\n    });\n\n    var legendData = seriesConfigs.map(function(s) { return s.label; });\n\n    var option = {\n        tooltip: {\n            trigger: 'axis',\n            formatter: function(params) {\n                if (!params || !params.length) return '';\n                var d = new Date(params[0].value[0]);\n                var result = d.toLocaleString() + '<br/>';\n                params.forEach(function(p) {\n                    if (p.value && p.value[1] !== null) {\n                        result += '<span style=\"display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:' + p.color + ';\"></span>';\n                        result += p.seriesName + ': ' + p.value[1].toFixed(2) + '<br/>';\n                    }\n                });\n                return result;\n            }\n        },\n        legend: { data: legendData, bottom: showDataZoomSlider ? 30 : 5 },\n        grid: { left: 60, right: 20, top: 40, bottom: showDataZoomSlider ? 60 : 40 },\n        xAxis: { type: 'time', axisLabel: { fontSize: 10 } },\n        yAxis: { type: 'value', axisLabel: { fontSize: 10 } },\n        dataZoom: showDataZoomSlider ? [\n            { type: 'inside' },\n            { type: 'slider', bottom: 5, height: 20 }\n        ] : [{ type: 'inside' }],\n        toolbox: showToolbox ? {\n            show: true,\n            right: 10,\n            top: 5,\n            feature: {\n                saveAsImage: toolboxFeatures.indexOf('saveAsImage') !== -1 ? { show: true } : undefined,\n                dataZoom: toolboxFeatures.indexOf('dataZoom') !== -1 ? { show: true } : undefined,\n                restore: toolboxFeatures.indexOf('restore') !== -1 ? { show: true } : undefined\n            }\n        } : null,\n        series: series\n    };\n\n    chart.setOption(option, true);\n\n    // Resize\n    setTimeout(function() {\n        if (chart && chartContainer) {\n            chart.resize({ width: chartContainer.offsetWidth, height: chartContainer.offsetHeight });\n        }\n    }, 100);\n}\n\nfunction showNoData(msg) {\n    if (!chart) return;\n    chart.setOption({\n        title: { text: msg, left: 'center', top: 'middle', textStyle: { color: '#999', fontSize: 14 } }\n    }, true);\n}\n\nself.typeParameters = function() {\n    return {\n        previewWidth: '100%',\n        previewHeight: '100%',\n        embedTitlePanel: false,\n        hasDataExportAction: true\n    };\n};\n",
    "settingsSchema": {
      "schema": {
        "type": "object",
        "title": "ECO Timeseries Zoom Sync Settings",
        "properties": {
          "chartType": {
            "title": "Chart Type",
            "type": "string",
            "default": "line",
            "enum": [
              "line",
              "bar",
              "area",
              "scatter"
            ]
          },
          "smoothLine": {
            "title": "Smooth Lines",
            "type": "boolean",
            "default": true
          },
          "chartLayout": {
            "title": "Chart Layout",
            "type": "string",
            "default": "combined",
            "enum": [
              "combined",
              "separate"
            ]
          },
          "showLegend": {
            "title": "Show Legend",
            "type": "boolean",
            "default": true
          },
          "legendStyle": {
            "title": "Legend Style",
            "type": "string",
            "default": "classic",
            "enum": [
              "classic",
              "card"
            ]
          },
          "legendPosition": {
            "title": "Legend Position",
            "type": "string",
            "default": "bottom",
            "enum": [
              "top",
              "bottom",
              "left",
              "right"
            ]
          },
          "legendAlign": {
            "title": "Legend Alignment",
            "type": "string",
            "default": "center",
            "enum": [
              "left",
              "center",
              "right"
            ]
          },
          "legendCardColorMode": {
            "title": "Card Color Mode",
            "type": "string",
            "default": "auto",
            "enum": [
              "auto",
              "manual",
              "gradient"
            ]
          },
          "legendCardColor": {
            "title": "Card Color",
            "type": "string",
            "default": "#2196F3"
          },
          "legendValues": {
            "title": "Statistics to Display",
            "type": "array",
            "items": {
              "type": "string"
            },
            "default": [
              "current"
            ]
          },
          "showTimestamp": {
            "title": "Show Timestamp",
            "type": "boolean",
            "default": true
          },
          "timestampFormat": {
            "title": "Timestamp Format",
            "type": "string",
            "default": "YYYY-MM-DD HH:mm:ss"
          },
          "showDataZoomSlider": {
            "title": "Show Zoom Slider",
            "type": "boolean",
            "default": true
          },
          "yAxisMin": {
            "title": "Y-Axis Minimum",
            "type": "number"
          },
          "yAxisMax": {
            "title": "Y-Axis Maximum",
            "type": "number"
          },
          "yAxis2Min": {
            "title": "Second Y-Axis Minimum",
            "type": "number"
          },
          "yAxis2Max": {
            "title": "Second Y-Axis Maximum",
            "type": "number"
          },
          "removeOutliers": {
            "title": "Remove Outliers",
            "type": "boolean",
            "default": false
          },
          "outlierMethod": {
            "title": "Outlier Method",
            "type": "string",
            "default": "iqr",
            "enum": [
              "iqr",
              "zscore",
              "manual"
            ]
          },
          "outlierIqrMultiplier": {
            "title": "IQR Multiplier",
            "type": "number",
            "default": 1.5
          },
          "outlierZscoreThreshold": {
            "title": "Z-Score Threshold",
            "type": "number",
            "default": 3
          },
          "outlierMinValue": {
            "title": "Minimum Value",
            "type": "number"
          },
          "outlierMaxValue": {
            "title": "Maximum Value",
            "type": "number"
          },
          "smoothingEnabled": {
            "title": "Enable Smoothing",
            "type": "boolean",
            "default": false
          },
          "smoothingWindowMinutes": {
            "title": "Smoothing Window (minutes)",
            "type": "number",
            "default": 15
          },
          "showToolbox": {
            "title": "Show Toolbox",
            "type": "boolean",
            "default": true
          },
          "toolboxFeatures": {
            "title": "Toolbox Features",
            "type": "array",
            "items": {
              "type": "string"
            },
            "default": [
              "saveAsImage",
              "dataView",
              "dataZoom",
              "restore"
            ]
          },
          "showTimewindowSelector": {
            "title": "Show Timewindow Selector",
            "type": "boolean",
            "default": false
          },
          "twSelectorColor": {
            "title": "Selector Color",
            "type": "string",
            "default": ""
          },
          "twSelectorPosition": {
            "title": "Selector Position",
            "type": "string",
            "default": "center",
            "enum": [
              "left",
              "center",
              "right"
            ]
          },
          "twSelectorDayFormat": {
            "title": "Day Format",
            "type": "string",
            "default": "DD.MM.YYYY"
          },
          "twSelectorWeekFormat": {
            "title": "Week Format",
            "type": "string",
            "default": "DD.MM.YYYY - DD.MM.YYYY"
          },
          "twSelectorMonthFormat": {
            "title": "Month Format",
            "type": "string",
            "default": "MMMM YYYY"
          },
          "twSelectorDefaultMode": {
            "title": "Default Mode",
            "type": "string",
            "default": "custom",
            "enum": [
              "custom",
              "day",
              "week",
              "month"
            ]
          },
          "twCustomStartTime": {
            "title": "Custom Start Time",
            "type": "string",
            "default": ""
          },
          "twCustomEndTime": {
            "title": "Custom End Time",
            "type": "string",
            "default": ""
          },
          "twAggregationType": {
            "title": "Aggregation",
            "type": "string",
            "default": "NONE",
            "enum": [
              "NONE",
              "AVG",
              "MIN",
              "MAX",
              "SUM",
              "COUNT"
            ]
          },
          "twMaxDataPoints": {
            "title": "Max Data Points",
            "type": "number",
            "default": 100000
          }
        },
        "required": []
      },
      "form": [
        [
          {
            "key": "chartType",
            "type": "rc-select",
            "multiple": false,
            "items": [
              {
                "value": "line",
                "label": "Line Chart"
              },
              {
                "value": "bar",
                "label": "Bar Chart"
              },
              {
                "value": "area",
                "label": "Area Chart"
              },
              {
                "value": "scatter",
                "label": "Scatter Plot"
              }
            ]
          },
          {
            "key": "smoothLine",
            "condition": "model.chartType === 'line' || model.chartType === 'area'"
          },
          {
            "key": "chartLayout",
            "type": "rc-select",
            "multiple": false,
            "items": [
              {
                "value": "combined",
                "label": "Combined (Single Chart)"
              },
              {
                "value": "separate",
                "label": "Separate Charts (Synced Zoom)"
              }
            ]
          },
          "showDataZoomSlider"
        ],
        [
          "showLegend",
          {
            "key": "legendStyle",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showLegend === true",
            "items": [
              {
                "value": "classic",
                "label": "Classic (Text)"
              },
              {
                "value": "card",
                "label": "Statistics Card"
              }
            ]
          },
          {
            "key": "legendPosition",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showLegend === true",
            "items": [
              {
                "value": "top",
                "label": "Top"
              },
              {
                "value": "bottom",
                "label": "Bottom"
              },
              {
                "value": "left",
                "label": "Left"
              },
              {
                "value": "right",
                "label": "Right"
              }
            ]
          },
          {
            "key": "legendAlign",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showLegend === true && model.legendStyle === 'card'",
            "items": [
              {
                "value": "left",
                "label": "Left"
              },
              {
                "value": "center",
                "label": "Center"
              },
              {
                "value": "right",
                "label": "Right"
              }
            ]
          },
          {
            "key": "legendCardColorMode",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showLegend === true && model.legendStyle === 'card'",
            "items": [
              {
                "value": "auto",
                "label": "Auto (Series Color)"
              },
              {
                "value": "manual",
                "label": "Manual Color"
              },
              {
                "value": "gradient",
                "label": "Gradient"
              }
            ]
          },
          {
            "key": "legendCardColor",
            "type": "color",
            "condition": "model.showLegend === true && model.legendStyle === 'card' && model.legendCardColorMode === 'manual'"
          },
          {
            "key": "legendValues",
            "type": "rc-select",
            "multiple": true,
            "condition": "model.showLegend === true && model.legendStyle === 'card'",
            "items": [
              {
                "value": "current",
                "label": "Current Value"
              },
              {
                "value": "min",
                "label": "Minimum"
              },
              {
                "value": "max",
                "label": "Maximum"
              },
              {
                "value": "mean",
                "label": "Mean"
              },
              {
                "value": "median",
                "label": "Median"
              },
              {
                "value": "sum",
                "label": "Sum"
              },
              {
                "value": "count",
                "label": "Count"
              }
            ]
          },
          {
            "key": "showTimestamp",
            "condition": "model.showLegend === true && model.legendStyle === 'card'"
          },
          {
            "key": "timestampFormat",
            "condition": "model.showLegend === true && model.legendStyle === 'card' && model.showTimestamp === true"
          }
        ],
        [
          "yAxisMin",
          "yAxisMax",
          "yAxis2Min",
          "yAxis2Max"
        ],
        [
          "removeOutliers",
          {
            "key": "outlierMethod",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.removeOutliers === true",
            "items": [
              {
                "value": "iqr",
                "label": "IQR (Interquartile Range)"
              },
              {
                "value": "zscore",
                "label": "Z-Score"
              },
              {
                "value": "manual",
                "label": "Manual Thresholds"
              }
            ]
          },
          {
            "key": "outlierIqrMultiplier",
            "condition": "model.removeOutliers === true && model.outlierMethod === 'iqr'"
          },
          {
            "key": "outlierZscoreThreshold",
            "condition": "model.removeOutliers === true && model.outlierMethod === 'zscore'"
          },
          {
            "key": "outlierMinValue",
            "condition": "model.removeOutliers === true && model.outlierMethod === 'manual'"
          },
          {
            "key": "outlierMaxValue",
            "condition": "model.removeOutliers === true && model.outlierMethod === 'manual'"
          },
          "smoothingEnabled",
          {
            "key": "smoothingWindowMinutes",
            "condition": "model.smoothingEnabled === true"
          }
        ],
        [
          "showToolbox",
          {
            "key": "toolboxFeatures",
            "type": "rc-select",
            "multiple": true,
            "condition": "model.showToolbox === true",
            "items": [
              {
                "value": "saveAsImage",
                "label": "Save as Image"
              },
              {
                "value": "dataView",
                "label": "Data View"
              },
              {
                "value": "dataZoom",
                "label": "Data Zoom"
              },
              {
                "value": "restore",
                "label": "Restore"
              }
            ]
          }
        ],
        [
          "showTimewindowSelector",
          {
            "key": "twSelectorColor",
            "type": "color",
            "condition": "model.showTimewindowSelector === true",
            "description": "Leave empty for auto (uses series color)"
          },
          {
            "key": "twSelectorPosition",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showTimewindowSelector === true",
            "items": [
              {
                "value": "left",
                "label": "Left"
              },
              {
                "value": "center",
                "label": "Center"
              },
              {
                "value": "right",
                "label": "Right"
              }
            ]
          },
          {
            "key": "twSelectorDefaultMode",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showTimewindowSelector === true",
            "items": [
              {
                "value": "custom",
                "label": "Custom (C) - Dashboard Timewindow"
              },
              {
                "value": "day",
                "label": "Day (D)"
              },
              {
                "value": "week",
                "label": "Week (W)"
              },
              {
                "value": "month",
                "label": "Month (M)"
              }
            ]
          },
          {
            "key": "twSelectorDayFormat",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showTimewindowSelector === true",
            "items": [
              {
                "value": "DD.MM.YYYY",
                "label": "DD.MM.YYYY (25.01.2026)"
              },
              {
                "value": "D.M.YYYY",
                "label": "D.M.YYYY (25.1.2026)"
              },
              {
                "value": "DD.MM.YY",
                "label": "DD.MM.YY (25.01.26)"
              },
              {
                "value": "D MMM YYYY",
                "label": "D MMM YYYY (25 Jan 2026)"
              },
              {
                "value": "D MMMM YYYY",
                "label": "D MMMM YYYY (25 Januar 2026)"
              }
            ]
          },
          {
            "key": "twSelectorWeekFormat",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showTimewindowSelector === true",
            "items": [
              {
                "value": "DD.MM.YYYY - DD.MM.YYYY",
                "label": "DD.MM.YYYY - DD.MM.YYYY (19.01.2026 - 25.01.2026)"
              },
              {
                "value": "DD.MM. - DD.MM.YYYY",
                "label": "DD.MM. - DD.MM.YYYY (19.01. - 25.01.2026)"
              },
              {
                "value": "DD.MM.YY - DD.MM.YY",
                "label": "DD.MM.YY - DD.MM.YY (19.01.26 - 25.01.26)"
              },
              {
                "value": "D-D MMM YYYY",
                "label": "D-D MMM YYYY (19-25 Jan 2026)"
              },
              {
                "value": "D MMM - D MMM",
                "label": "D MMM - D MMM (19 Jan - 25 Jan)"
              }
            ]
          },
          {
            "key": "twSelectorMonthFormat",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showTimewindowSelector === true",
            "items": [
              {
                "value": "MMMM YYYY",
                "label": "MMMM YYYY (Januar 2026)"
              },
              {
                "value": "MMM YYYY",
                "label": "MMM YYYY (Jan 2026)"
              },
              {
                "value": "MM/YYYY",
                "label": "MM/YYYY (01/2026)"
              },
              {
                "value": "MM.YYYY",
                "label": "MM.YYYY (01.2026)"
              }
            ]
          },
          {
            "key": "twCustomStartTime",
            "condition": "model.showTimewindowSelector === true",
            "description": "Use ${attributeName} for entity attributes, e.g. ${startTimeMs}"
          },
          {
            "key": "twCustomEndTime",
            "condition": "model.showTimewindowSelector === true",
            "description": "Use ${attributeName} for entity attributes, e.g. ${endTimeMs}"
          },
          {
            "key": "twAggregationType",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showTimewindowSelector === true",
            "items": [
              {
                "value": "NONE",
                "label": "None (Raw Data)"
              },
              {
                "value": "AVG",
                "label": "Average"
              },
              {
                "value": "MIN",
                "label": "Minimum"
              },
              {
                "value": "MAX",
                "label": "Maximum"
              },
              {
                "value": "SUM",
                "label": "Sum"
              },
              {
                "value": "COUNT",
                "label": "Count"
              }
            ]
          },
          {
            "key": "twMaxDataPoints",
            "condition": "model.showTimewindowSelector === true",
            "description": "Maximum number of data points to fetch (default: 100000)"
          }
        ]
      ],
      "groupInfoes": [
        {
          "formIndex": 0,
          "GroupTitle": "Chart Settings"
        },
        {
          "formIndex": 1,
          "GroupTitle": "Legend Settings"
        },
        {
          "formIndex": 2,
          "GroupTitle": "Y-Axis Settings"
        },
        {
          "formIndex": 3,
          "GroupTitle": "Data Processing"
        },
        {
          "formIndex": 4,
          "GroupTitle": "Toolbox Settings"
        },
        {
          "formIndex": 5,
          "GroupTitle": "Timewindow Selector"
        }
      ]
    },
    "dataKeySettingsSchema": {},
    "latestDataKeySettingsSchema": {},
    "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Temperature\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.456,\"funcBody\":\"var value = prevValue + Math.random() * 10 - 5;\\nif (value < 0) value = 0;\\nif (value > 100) value = 100;\\nreturn value;\",\"units\":\"C\",\"decimals\":1},{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Humidity\",\"color\":\"#4CAF50\",\"settings\":{},\"_hash\":0.789,\"funcBody\":\"var value = prevValue + Math.random() * 8 - 4;\\nif (value < 20) value = 20;\\nif (value > 90) value = 90;\\nreturn value;\",\"units\":\"%\",\"decimals\":1}]}],\"timewindow\":{\"hideInterval\":false,\"hideLastInterval\":false,\"hideQuickInterval\":false,\"hideAggregation\":false,\"hideAggInterval\":false,\"hideTimezone\":false,\"selectedTab\":0,\"realtime\":{\"realtimeType\":0,\"timewindowMs\":3600000,\"quickInterval\":\"CURRENT_HOUR\",\"interval\":5000},\"aggregation\":{\"type\":\"AVG\",\"limit\":25000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"chartType\":\"line\",\"smoothLine\":true,\"showLegend\":true,\"legendStyle\":\"classic\",\"legendPosition\":\"bottom\",\"legendAlign\":\"center\",\"legendCardColorMode\":\"auto\",\"legendCardColor\":\"#2196F3\",\"legendValues\":[\"current\"],\"showTimestamp\":true,\"timestampFormat\":\"YYYY-MM-DD HH:mm:ss\",\"showDataZoomSlider\":true,\"showToolbox\":true,\"toolboxFeatures\":[\"saveAsImage\",\"dataView\",\"dataZoom\",\"restore\"]},\"title\":\"ECO Timeseries Zoom Sync\",\"dropShadow\":true,\"enableFullscreen\":true,\"useDashboardTimewindow\":true,\"displayTimewindow\":true}"
  },
  "tags": [
    "chart",
    "timeseries",
    "time-series",
    "zoom",
    "line",
    "line chart",
    "bar",
    "bar chart",
    "area",
    "scatter",
    "echarts",
    "statistics",
    "dual-axis"
  ]
}