{
  "fqn": "eco_custom_widgets.eco_measurement_hierarchy_sankey",
  "name": "Measurement Hierarchy & Sankey",
  "deprecated": false,
  "image": "tb-image;/api/images/system/chart.svg",
  "description": "Visualizes measurement hierarchy with tree view and Sankey energy flow diagram. Shows unmeasured/unaccounted energy as virtual nodes. Supports navigation via click.",
  "descriptor": {
    "type": "latest",
    "sizeX": 16,
    "sizeY": 10,
    "resources": [
      {
        "url": "https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"
      },
      {
        "url": "https://cdn.jsdelivr.net/gh/JiriD85/ECO-TB-Custom-Widgets@main/widgets/resources/eco-widget-utils.js"
      }
    ],
    "templateHtml": "<div id=\"widget-wrapper\" style=\"width: 100%; height: 100%; display: flex; flex-direction: column;\">\n  <div id=\"toolbar\" style=\"display: flex; align-items: center; gap: 8px; padding: 4px 8px; border-bottom: 1px solid #e0e0e0; flex-shrink: 0;\">\n    <button class=\"toolbar-btn\" id=\"btn-refresh\" title=\"Refresh\">&#8635; Refresh</button>\n    <button class=\"toolbar-btn\" id=\"btn-expand\" title=\"Expand All\">&#8862; Expand</button>\n    <button class=\"toolbar-btn\" id=\"btn-collapse\" title=\"Collapse All\">&#8863; Collapse</button>\n    <span style=\"flex: 1;\"></span>\n    <span id=\"current-entity\" style=\"font-size: 12px; color: #666;\"></span>\n  </div>\n  <div id=\"charts-container\" style=\"flex: 1; min-height: 0; display: flex; gap: 8px; padding: 8px;\">\n    <div id=\"tree-container\" style=\"flex: 1; min-height: 0; min-width: 0;\"></div>\n    <div id=\"sankey-container\" style=\"flex: 2; min-height: 0; min-width: 0;\"></div>\n  </div>\n  <div id=\"legend-container\" style=\"display: flex; justify-content: center; gap: 16px; padding: 4px 8px; font-size: 11px; color: #666; flex-shrink: 0;\">\n    <div class=\"legend-item\"><div class=\"legend-dot\" style=\"background: #f44336;\"></div><span>Heating</span></div>\n    <div class=\"legend-item\"><div class=\"legend-dot\" style=\"background: #2196f3;\"></div><span>Cooling</span></div>\n    <div class=\"legend-item\"><div class=\"legend-dot unmeasured\"></div><span>Unmeasured</span></div>\n  </div>\n</div>",
    "templateCss": "#widget-wrapper { font-family: Roboto, sans-serif; }\n#toolbar { background: #fafafa; }\n#charts-container { background: #fff; }\n.toolbar-btn { padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; cursor: pointer; font-size: 12px; }\n.toolbar-btn:hover { background: #f5f5f5; }\n.toolbar-btn.active { background: #e3f2fd; border-color: #1976d2; }\n.legend-item { display: flex; align-items: center; gap: 4px; }\n.legend-dot { width: 12px; height: 12px; border-radius: 2px; }\n.legend-dot.unmeasured { border: 2px dashed #9e9e9e; background: transparent; }\n@media (max-width: 768px) {\n  #charts-container { flex-direction: column; }\n  #tree-container, #sankey-container { flex: 1; }\n}",
    "controllerScript": "var treeChart = null;\nvar sankeyChart = null;\nvar treeContainer = null;\nvar sankeyContainer = null;\nvar resizeObserver = null;\nvar utils = null;\nvar hierarchyData = null;\nvar currentEntityId = null;\nvar isLoading = false;\n\n// ECO Design Colors\nvar COLORS = {\n    heating: '#f44336',\n    cooling: '#2196f3',\n    heatingLight: '#ffcdd2',\n    coolingLight: '#bbdefb',\n    unmeasured: '#9e9e9e',\n    generator: '#4caf50',\n    subDistribution: '#ff9800',\n    circuit: '#9c27b0',\n    active: '#4caf50',\n    inactive: '#bdbdbd'\n};\n\nvar ROLE_ICONS = {\n    generator: '\\u26a1',\n    subDistribution: '\\u2934',\n    circuit: '\\u2744'\n};\n\n// Helper: fetch relations and filter by custom type client-side\n// TB's findByFrom/findByTo treat 2nd param as relationTypeGroup, not type name\nasync function findRelationsFrom(entityRelationService, entityId, relationType) {\n    var allRelations = await entityRelationService.findByFrom(entityId).toPromise();\n    return (allRelations || []).filter(function(r) { return r.type === relationType; });\n}\n\nasync function findRelationsTo(entityRelationService, entityId, relationType) {\n    var allRelations = await entityRelationService.findByTo(entityId).toPromise();\n    return (allRelations || []).filter(function(r) { return r.type === relationType; });\n}\n\nself.onInit = function() {\n    treeContainer = self.ctx.$container.find('#tree-container')[0];\n    sankeyContainer = self.ctx.$container.find('#sankey-container')[0];\n    \n    if (!treeContainer || !sankeyContainer) {\n        console.error('Chart containers not found');\n        return;\n    }\n    \n    if (typeof echarts === 'undefined') {\n        console.error('ECharts not loaded');\n        return;\n    }\n    \n    utils = window.ECOWidgetUtils;\n    \n    treeChart = echarts.init(treeContainer);\n    sankeyChart = echarts.init(sankeyContainer);\n    \n    setupToolbar();\n    setupLegend();\n    \n    // Resize fix pattern\n    [100, 250, 500, 1000].forEach(function(delay) {\n        setTimeout(function() {\n            if (treeChart && treeContainer) {\n                treeChart.resize({ width: treeContainer.offsetWidth, height: treeContainer.offsetHeight });\n            }\n            if (sankeyChart && sankeyContainer) {\n                sankeyChart.resize({ width: sankeyContainer.offsetWidth, height: sankeyContainer.offsetHeight });\n            }\n        }, delay);\n    });\n    \n    if (typeof ResizeObserver !== 'undefined') {\n        resizeObserver = new ResizeObserver(function() {\n            requestAnimationFrame(function() {\n                if (treeChart && treeContainer) {\n                    treeChart.resize({ width: treeContainer.offsetWidth, height: treeContainer.offsetHeight });\n                }\n                if (sankeyChart && sankeyContainer) {\n                    sankeyChart.resize({ width: sankeyContainer.offsetWidth, height: sankeyContainer.offsetHeight });\n                }\n            });\n        });\n        resizeObserver.observe(treeContainer);\n        resizeObserver.observe(sankeyContainer);\n    }\n};\n\nfunction setupToolbar() {\n    var toolbar = self.ctx.$container.find('#toolbar')[0];\n    var settings = self.ctx.settings || {};\n    \n    if (settings.showToolbar === false) {\n        toolbar.style.display = 'none';\n        return;\n    }\n    \n    var btnRefresh = toolbar.querySelector('#btn-refresh');\n    var btnExpand = toolbar.querySelector('#btn-expand');\n    var btnCollapse = toolbar.querySelector('#btn-collapse');\n    \n    if (btnRefresh) {\n        btnRefresh.onclick = function() {\n            isLoading = false;\n            loadHierarchy();\n        };\n    }\n    \n    if (btnExpand) {\n        btnExpand.onclick = function() {\n            if (hierarchyData && treeChart) {\n                renderTree(hierarchyData, true);\n            }\n        };\n    }\n    \n    if (btnCollapse) {\n        btnCollapse.onclick = function() {\n            if (hierarchyData && treeChart) {\n                renderTree(hierarchyData, false);\n            }\n        };\n    }\n}\n\nfunction setupLegend() {\n    var legendContainer = self.ctx.$container.find('#legend-container')[0];\n    var settings = self.ctx.settings || {};\n    \n    if (settings.showLegend === false) {\n        legendContainer.style.display = 'none';\n    }\n}\n\nself.onDataUpdated = function() {\n    var data = self.ctx.data || [];\n    if (data.length > 0 && data[0].datasource && data[0].datasource.entity) {\n        var entity = data[0].datasource.entity;\n        if (!currentEntityId || currentEntityId.id !== entity.id.id) {\n            currentEntityId = entity.id;\n            loadHierarchy();\n        }\n    }\n};\n\nasync function loadHierarchy() {\n    if (isLoading) return;\n    if (!self.ctx.data || !self.ctx.data.length) return;\n    \n    var datasource = self.ctx.data[0].datasource;\n    if (!datasource || !datasource.entity) return;\n    \n    isLoading = true;\n    var rootEntity = datasource.entity;\n    currentEntityId = rootEntity.id;\n    \n    var settings = self.ctx.settings || {};\n    var relationType = settings.relationType || 'MeasurementHierarchy';\n    var powerAttribute = settings.powerAttribute || 'thermalPower';\n    \n    var currentEntitySpan = self.ctx.$container.find('#current-entity')[0];\n    if (currentEntitySpan) {\n        currentEntitySpan.textContent = rootEntity.label || rootEntity.name || '';\n    }\n    \n    treeChart.showLoading();\n    sankeyChart.showLoading();\n    \n    try {\n        var $injector = self.ctx.$scope.$injector;\n        var entityRelationService = $injector.get(self.ctx.servicesMap.get('entityRelationService'));\n        var attributeService = $injector.get(self.ctx.servicesMap.get('attributeService'));\n        \n        // Find root (go up the MeasurementHierarchy)\n        var root = await findRoot(rootEntity.id, entityRelationService, attributeService, relationType);\n        \n        // Build tree from root, only following MeasurementHierarchy relations\n        hierarchyData = await buildHierarchyTree(root.entityId, entityRelationService, attributeService, relationType, powerAttribute, 0, rootEntity.id.id);\n        \n        treeChart.hideLoading();\n        sankeyChart.hideLoading();\n        \n        if (hierarchyData) {\n            renderTree(hierarchyData, true);\n            renderSankey(hierarchyData);\n        }\n    } catch (e) {\n        console.error('Failed to load hierarchy:', e);\n        treeChart.hideLoading();\n        sankeyChart.hideLoading();\n        showError('Failed to load hierarchy: ' + e.message);\n    } finally {\n        isLoading = false;\n    }\n}\n\nasync function findRoot(entityId, entityRelationService, attributeService, relationType) {\n    var current = { entityId: entityId, attributes: {} };\n    var visited = {};\n    var maxDepth = 10;\n    var depth = 0;\n    \n    while (depth < maxDepth) {\n        var key = current.entityId.entityType + ':' + current.entityId.id;\n        if (visited[key]) break;\n        visited[key] = true;\n        \n        try {\n            var relations = await findRelationsTo(entityRelationService, current.entityId, relationType);\n            if (!relations || relations.length === 0) {\n                break;\n            }\n            current = { entityId: relations[0].from, attributes: {} };\n            depth++;\n        } catch (e) {\n            break;\n        }\n    }\n    \n    // Load root attributes\n    try {\n        var attrs = await attributeService.getEntityAttributes(\n            current.entityId, 'SERVER_SCOPE',\n            ['Label', 'measurementRole', 'installationType', 'state']\n        ).toPromise();\n        attrs.forEach(function(a) { current.attributes[a.key] = a.value; });\n    } catch (e) {}\n    \n    return current;\n}\n\nasync function buildHierarchyTree(entityId, entityRelationService, attributeService, relationType, powerAttribute, depth, selectedId) {\n    if (depth > 6) return null;\n    \n    var node = {\n        id: entityId.id,\n        entityId: entityId,\n        name: '',\n        label: '',\n        role: 'circuit',\n        installationType: 'heating',\n        power: 0,\n        isActive: true,\n        isVirtual: false,\n        isSelected: entityId.id === selectedId,\n        children: [],\n        depth: depth\n    };\n    \n    // Load attributes\n    try {\n        var attrs = await attributeService.getEntityAttributes(\n            entityId, 'SERVER_SCOPE',\n            ['Label', 'name', 'measurementRole', 'installationType', 'state']\n        ).toPromise();\n        \n        attrs.forEach(function(a) {\n            if (a.key === 'Label' || a.key === 'name') node.label = a.value || node.label;\n            if (a.key === 'measurementRole') node.role = a.value || 'circuit';\n            if (a.key === 'installationType') node.installationType = a.value || 'heating';\n            if (a.key === 'state') node.isActive = a.value === 'active';\n        });\n        node.name = node.label || entityId.id.substring(0, 8);\n    } catch (e) {\n        node.name = entityId.id.substring(0, 8);\n    }\n    \n    // Load power telemetry (latest value)\n    try {\n        var telemetry = await attributeService.getEntityAttributes(\n            entityId, 'CLIENT_SCOPE', [powerAttribute]\n        ).toPromise();\n        if (telemetry && telemetry.length > 0) {\n            node.power = parseFloat(telemetry[0].value) || 0;\n        } else {\n            var sharedTelemetry = await attributeService.getEntityAttributes(\n                entityId, 'SHARED_SCOPE', [powerAttribute]\n            ).toPromise();\n            if (sharedTelemetry && sharedTelemetry.length > 0) {\n                node.power = parseFloat(sharedTelemetry[0].value) || 0;\n            }\n        }\n    } catch (e) {}\n    \n    // Load children - filtered by MeasurementHierarchy type\n    try {\n        var relations = await findRelationsFrom(entityRelationService, entityId, relationType);\n        if (relations && relations.length > 0) {\n            var childPromises = relations.map(function(rel) {\n                return buildHierarchyTree(rel.to, entityRelationService, attributeService, relationType, powerAttribute, depth + 1, selectedId);\n            });\n            var children = await Promise.all(childPromises);\n            node.children = children.filter(function(c) { return c !== null; });\n            \n            // Calculate unmeasured rest\n            if (node.children.length > 0) {\n                var childrenSum = node.children.reduce(function(sum, c) { return sum + (c.power || 0); }, 0);\n                var diff = node.power - childrenSum;\n                \n                if (diff > 0.1) {\n                    node.children.push({\n                        id: node.id + '_unmeasured',\n                        entityId: null,\n                        name: 'Unmeasured',\n                        label: 'Unmeasured',\n                        role: 'unmeasured',\n                        installationType: node.installationType,\n                        power: diff,\n                        isActive: true,\n                        isVirtual: true,\n                        isSelected: false,\n                        children: [],\n                        depth: depth + 1\n                    });\n                }\n            }\n        }\n    } catch (e) {\n        console.warn('Failed to load children:', e);\n    }\n    \n    return node;\n}\n\nfunction renderTree(data, expandAll) {\n    if (!treeChart || !data) return;\n    \n    var settings = self.ctx.settings || {};\n    \n    function transformToEChartsTree(node) {\n        var color = node.isVirtual ? COLORS.unmeasured :\n                    node.installationType === 'cooling' ? COLORS.cooling : COLORS.heating;\n        \n        var icon = ROLE_ICONS[node.role] || '';\n        var powerStr = node.power !== undefined ? ' (' + formatPower(node.power) + ')' : '';\n        \n        return {\n            name: icon + ' ' + node.name + powerStr,\n            value: node.power,\n            collapsed: !expandAll && node.depth > 1,\n            itemStyle: {\n                color: color,\n                borderColor: node.isSelected ? '#1976d2' : (node.isVirtual ? '#9e9e9e' : color),\n                borderWidth: node.isSelected ? 3 : 1,\n                borderType: node.isVirtual ? 'dashed' : 'solid'\n            },\n            lineStyle: {\n                color: node.isVirtual ? '#9e9e9e' : '#999',\n                type: node.isVirtual ? 'dashed' : 'solid'\n            },\n            label: {\n                color: node.isActive ? '#333' : '#999',\n                fontWeight: node.isSelected ? 'bold' : 'normal'\n            },\n            nodeData: node,\n            children: node.children.map(transformToEChartsTree)\n        };\n    }\n    \n    var treeData = transformToEChartsTree(data);\n    \n    var option = {\n        tooltip: {\n            trigger: 'item',\n            formatter: function(params) {\n                var nd = params.data.nodeData;\n                if (!nd) return params.name;\n                \n                var lines = [];\n                lines.push(nd.name);\n                lines.push('Role: ' + nd.role);\n                lines.push('Type: ' + nd.installationType);\n                lines.push('Power: ' + formatPower(nd.power));\n                lines.push('Status: ' + (nd.isActive ? 'Active' : 'Inactive'));\n                if (nd.isVirtual) lines.push('(Calculated difference)');\n                return lines.join('\\n');\n            }\n        },\n        series: [{\n            type: 'tree',\n            data: [treeData],\n            top: '5%',\n            left: '10%',\n            bottom: '5%',\n            right: '20%',\n            symbolSize: 14,\n            orient: 'LR',\n            label: {\n                position: 'right',\n                verticalAlign: 'middle',\n                align: 'left',\n                fontSize: 11\n            },\n            leaves: {\n                label: {\n                    position: 'right',\n                    verticalAlign: 'middle',\n                    align: 'left'\n                }\n            },\n            emphasis: {\n                focus: 'descendant'\n            },\n            expandAndCollapse: true,\n            animationDuration: 300,\n            animationDurationUpdate: 300\n        }]\n    };\n    \n    treeChart.setOption(option, true);\n    \n    // Click handler for navigation\n    treeChart.off('click');\n    treeChart.on('click', function(params) {\n        if (params.data && params.data.nodeData && !params.data.nodeData.isVirtual) {\n            navigateToEntity(params.data.nodeData);\n        }\n    });\n}\n\nfunction renderSankey(data) {\n    if (!sankeyChart || !data) return;\n    \n    var settings = self.ctx.settings || {};\n    var nodes = [];\n    var links = [];\n    var nodeSet = {};\n    \n    function collectNodesAndLinks(node, parent) {\n        if (!nodeSet[node.id]) {\n            nodeSet[node.id] = true;\n            \n            var color = node.isVirtual ? COLORS.unmeasured :\n                        node.installationType === 'cooling' ? COLORS.cooling : COLORS.heating;\n            \n            nodes.push({\n                name: node.name,\n                itemStyle: {\n                    color: color,\n                    borderColor: node.isVirtual ? '#9e9e9e' : color,\n                    borderType: node.isVirtual ? 'dashed' : 'solid'\n                },\n                nodeData: node\n            });\n        }\n        \n        if (parent && node.power > 0) {\n            links.push({\n                source: parent.name,\n                target: node.name,\n                value: node.power,\n                lineStyle: {\n                    color: node.isVirtual ? COLORS.unmeasured : \n                           (node.installationType === 'cooling' ? COLORS.coolingLight : COLORS.heatingLight),\n                    opacity: node.isVirtual ? 0.3 : 0.5\n                }\n            });\n        }\n        \n        node.children.forEach(function(child) {\n            collectNodesAndLinks(child, node);\n        });\n    }\n    \n    collectNodesAndLinks(data, null);\n    \n    if (nodes.length === 0 || links.length === 0) {\n        sankeyChart.setOption({\n            title: { \n                text: 'No flow data available', \n                left: 'center', \n                top: 'middle',\n                textStyle: { color: '#999', fontSize: 14 }\n            }\n        }, true);\n        return;\n    }\n    \n    var option = {\n        tooltip: {\n            trigger: 'item',\n            formatter: function(params) {\n                if (params.dataType === 'edge') {\n                    return params.data.source + ' -> ' + params.data.target + \n                           '\\nFlow: ' + formatPower(params.data.value);\n                } else {\n                    var nd = params.data.nodeData;\n                    if (!nd) return params.name;\n                    return nd.name + '\\nPower: ' + formatPower(nd.power);\n                }\n            }\n        },\n        series: [{\n            type: 'sankey',\n            data: nodes,\n            links: links,\n            orient: settings.sankeyOrient || 'horizontal',\n            nodeWidth: settings.nodeWidth || 20,\n            nodeGap: settings.nodeGap || 12,\n            layoutIterations: 32,\n            left: 50,\n            right: 50,\n            top: 20,\n            bottom: 20,\n            emphasis: {\n                focus: 'adjacency'\n            },\n            label: {\n                position: 'right',\n                fontSize: 11\n            },\n            lineStyle: {\n                curveness: 0.5\n            }\n        }]\n    };\n    \n    sankeyChart.setOption(option, true);\n    \n    // Click handler for navigation\n    sankeyChart.off('click');\n    sankeyChart.on('click', function(params) {\n        if (params.dataType === 'node' && params.data && params.data.nodeData && !params.data.nodeData.isVirtual) {\n            navigateToEntity(params.data.nodeData);\n        }\n    });\n}\n\nfunction navigateToEntity(nodeData) {\n    if (!nodeData || !nodeData.entityId) return;\n    \n    var settings = self.ctx.settings || {};\n    var targetState = settings.targetState || '';\n    \n    if (targetState && self.ctx.dashboard && self.ctx.dashboard.stateChanged) {\n        var params = {\n            entityId: nodeData.entityId,\n            entityName: nodeData.name,\n            entityLabel: nodeData.label\n        };\n        self.ctx.dashboard.stateChanged(targetState, params);\n    } else if (self.ctx.dashboard && self.ctx.dashboard.selectEntity) {\n        self.ctx.dashboard.selectEntity({\n            entityType: nodeData.entityId.entityType,\n            id: nodeData.entityId.id\n        });\n    }\n}\n\nfunction formatPower(value) {\n    if (value === null || value === undefined) return 'N/A';\n    if (Math.abs(value) >= 1000) return (value / 1000).toFixed(1) + ' MW';\n    if (Math.abs(value) >= 1) return value.toFixed(1) + ' kW';\n    return (value * 1000).toFixed(0) + ' W';\n}\n\nfunction showError(message) {\n    treeChart.setOption({\n        title: { text: message, left: 'center', top: 'middle', textStyle: { color: '#f44336' } }\n    }, true);\n    sankeyChart.setOption({\n        title: { text: '', left: 'center', top: 'middle' }\n    }, true);\n}\n\nself.onResize = function() {\n    if (treeChart && treeContainer) {\n        treeChart.resize({ width: treeContainer.offsetWidth, height: treeContainer.offsetHeight });\n    }\n    if (sankeyChart && sankeyContainer) {\n        sankeyChart.resize({ width: sankeyContainer.offsetWidth, height: sankeyContainer.offsetHeight });\n    }\n};\n\nself.onDestroy = function() {\n    if (resizeObserver) {\n        resizeObserver.disconnect();\n        resizeObserver = null;\n    }\n    if (treeChart) {\n        treeChart.dispose();\n        treeChart = null;\n    }\n    if (sankeyChart) {\n        sankeyChart.dispose();\n        sankeyChart = null;\n    }\n};\n\nself.typeParameters = function() {\n    return {\n        previewWidth: '100%',\n        previewHeight: '100%',\n        embedTitlePanel: false,\n        datasourcesOptional: false,\n        defaultDataKeysCount: 1\n    };\n};\n",
    "settingsSchema": {
      "schema": {
        "type": "object",
        "title": "Measurement Hierarchy Settings",
        "properties": {
          "relationType": {
            "title": "Relation Type",
            "type": "string",
            "default": "MeasurementHierarchy"
          },
          "powerAttribute": {
            "title": "Power Attribute",
            "type": "string",
            "default": "thermalPower"
          },
          "targetState": {
            "title": "Target Dashboard State",
            "type": "string",
            "default": ""
          },
          "showToolbar": {
            "title": "Show Toolbar",
            "type": "boolean",
            "default": true
          },
          "showLegend": {
            "title": "Show Legend",
            "type": "boolean",
            "default": true
          },
          "sankeyOrient": {
            "title": "Sankey Orientation",
            "type": "string",
            "default": "horizontal",
            "enum": ["horizontal", "vertical"]
          },
          "nodeWidth": {
            "title": "Node Width (px)",
            "type": "number",
            "default": 20,
            "minimum": 10,
            "maximum": 50
          },
          "nodeGap": {
            "title": "Node Gap (px)",
            "type": "number",
            "default": 12,
            "minimum": 5,
            "maximum": 30
          },
          "heatingColor": {
            "title": "Heating Color",
            "type": "string",
            "default": "#f44336"
          },
          "coolingColor": {
            "title": "Cooling Color",
            "type": "string",
            "default": "#2196f3"
          },
          "unmeasuredColor": {
            "title": "Unmeasured Color",
            "type": "string",
            "default": "#9e9e9e"
          }
        },
        "required": []
      },
      "form": [
        [
          "relationType",
          "powerAttribute",
          "targetState"
        ],
        [
          "showToolbar",
          "showLegend",
          {
            "key": "sankeyOrient",
            "type": "rc-select",
            "multiple": false,
            "items": [
              { "value": "horizontal", "label": "Horizontal (left to right)" },
              { "value": "vertical", "label": "Vertical (top to bottom)" }
            ]
          },
          "nodeWidth",
          "nodeGap"
        ],
        [
          { "key": "heatingColor", "type": "color" },
          { "key": "coolingColor", "type": "color" },
          { "key": "unmeasuredColor", "type": "color" }
        ]
      ],
      "groupInfoes": [
        { "formIndex": 0, "GroupTitle": "Data Settings" },
        { "formIndex": 1, "GroupTitle": "Layout Settings" },
        { "formIndex": 2, "GroupTitle": "Colors" }
      ]
    },
    "dataKeySettingsSchema": {},
    "latestDataKeySettingsSchema": {},
    "defaultConfig": "{\"datasources\":[{\"type\":\"entity\",\"dataKeys\":[{\"name\":\"thermalPower\",\"type\":\"timeseries\",\"label\":\"Thermal Power\",\"settings\":{}}]}],\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"0px\",\"settings\":{\"relationType\":\"MeasurementHierarchy\",\"powerAttribute\":\"thermalPower\",\"targetState\":\"\",\"showToolbar\":true,\"showLegend\":true,\"sankeyOrient\":\"horizontal\",\"nodeWidth\":20,\"nodeGap\":12,\"heatingColor\":\"#f44336\",\"coolingColor\":\"#2196f3\",\"unmeasuredColor\":\"#9e9e9e\"},\"title\":\"Measurement Hierarchy & Sankey\",\"dropShadow\":true,\"enableFullscreen\":true}"
  },
  "tags": [
    "chart",
    "latest",
    "sankey",
    "tree",
    "hierarchy",
    "energy",
    "flow",
    "measurement",
    "hvac",
    "echarts"
  ]
}
