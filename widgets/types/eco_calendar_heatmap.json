{
  "fqn": "eco_custom_widgets.eco_calendar_heatmap",
  "name": "Calendar Heatmap",
  "deprecated": false,
  "image": "tb-image;/api/images/system/chart.svg",
  "description": "GitHub-style calendar heatmap showing daily values across a year. Perfect for visualizing patterns, streaks, and seasonal trends.",
  "descriptor": {
    "type": "timeseries",
    "sizeX": 12,
    "sizeY": 4,
    "resources": [
      {
        "url": "https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"
      },
      {
        "url": "https://cdn.jsdelivr.net/gh/JiriD85/ECO-TB-Custom-Widgets@main/widgets/resources/eco-widget-utils.js"
      }
    ],
    "templateHtml": "<div id=\"widget-wrapper\" style=\"width: 100%; height: 100%; display: flex; flex-direction: column;\">\n  <div id=\"timewindow-selector\" style=\"display: none;\"></div>\n  <div id=\"stats-card-top\" style=\"padding: 4px 8px; display: none;\"></div>\n  <div style=\"flex: 1; min-height: 0; display: flex;\">\n    <div id=\"stats-card-left\" style=\"padding: 4px; display: none;\"></div>\n    <div id=\"chart-container\" style=\"flex: 1; min-height: 0;\"></div>\n    <div id=\"stats-card-right\" style=\"padding: 4px; display: none;\"></div>\n  </div>\n  <div id=\"stats-card-bottom\" style=\"padding: 4px 8px; display: none;\"></div>\n</div>",
    "templateCss": "#widget-wrapper { position: relative; }\n#chart-container { position: relative; }",
    "controllerScript": "/**\n * ECO Calendar Heatmap Widget (Library Version)\n *\n * GitHub-style calendar heatmap showing daily values across a year.\n * Perfect for visualizing patterns, streaks, and seasonal trends.\n *\n * This version uses ECOWidgetUtils library for common functionality.\n */\n\n// Get library reference\nvar utils = window.ECOWidgetUtils;\n\nvar chart = null;\nvar chartContainer = null;\nvar statsCardContainers = {};\nvar timewindowSelectorContainer = null;\nvar resizeObserver = null;\n\nself.onInit = function() {\n    chartContainer = self.ctx.$container.find('#chart-container')[0];\n    timewindowSelectorContainer = self.ctx.$container.find('#timewindow-selector')[0];\n    statsCardContainers = {\n        top: self.ctx.$container.find('#stats-card-top')[0],\n        bottom: self.ctx.$container.find('#stats-card-bottom')[0],\n        left: self.ctx.$container.find('#stats-card-left')[0],\n        right: self.ctx.$container.find('#stats-card-right')[0]\n    };\n\n    if (!chartContainer) {\n        console.error('ECO Calendar Heatmap: Chart container not found');\n        return;\n    }\n\n    if (typeof echarts === 'undefined') {\n        console.error('ECO Calendar Heatmap: ECharts library not loaded');\n        return;\n    }\n\n    if (!utils) {\n        console.error('ECO Calendar Heatmap: ECOWidgetUtils library not loaded');\n        return;\n    }\n\n    chart = echarts.init(chartContainer);\n    updateChart();\n\n    // Multiple delayed resizes for ThingsBoard's async layout\n    [100, 250, 500, 1000].forEach(function(delay) {\n        setTimeout(function() {\n            if (chart && chartContainer) {\n                chart.resize({\n                    width: chartContainer.offsetWidth,\n                    height: chartContainer.offsetHeight\n                });\n            }\n        }, delay);\n    });\n\n    // ResizeObserver for dynamic container changes\n    if (typeof ResizeObserver !== 'undefined') {\n        resizeObserver = new ResizeObserver(function() {\n            requestAnimationFrame(function() {\n                if (chart && chartContainer) {\n                    chart.resize({\n                        width: chartContainer.offsetWidth,\n                        height: chartContainer.offsetHeight\n                    });\n                }\n            });\n        });\n        resizeObserver.observe(chartContainer);\n    }\n};\n\nself.onDataUpdated = function() {\n    updateChart();\n};\n\nfunction getColorScheme(scheme, minColor, maxColor) {\n    switch (scheme) {\n        case 'github':\n            return ['#ebedf0', '#9be9a8', '#40c463', '#30a14e', '#216e39'];\n        case 'blue':\n            return ['#E3F2FD', '#90CAF9', '#42A5F5', '#1E88E5', '#0D47A1'];\n        case 'green':\n            return ['#E8F5E9', '#A5D6A7', '#66BB6A', '#43A047', '#1B5E20'];\n        case 'red':\n            return ['#FFEBEE', '#EF9A9A', '#EF5350', '#E53935', '#B71C1C'];\n        case 'purple':\n            return ['#F3E5F5', '#CE93D8', '#AB47BC', '#8E24AA', '#4A148C'];\n        case 'custom':\n            return [minColor || '#ebedf0', maxColor || '#216e39'];\n        default:\n            return ['#ebedf0', '#9be9a8', '#40c463', '#30a14e', '#216e39'];\n    }\n}\n\nfunction updateChart() {\n    if (!chart) return;\n\n    var settings = self.ctx.settings || {};\n    var data = self.ctx.data || [];\n\n    // Chart Settings\n    var yearDisplay = settings.yearDisplay || 'auto';\n    var customYear = settings.customYear || new Date().getFullYear();\n    var colorScheme = settings.colorScheme || 'github';\n    var minColor = settings.minColor;\n    var maxColor = settings.maxColor;\n    var cellSize = settings.cellSize || 14;\n    var showMonthLabel = settings.showMonthLabel !== false;\n    var showDayLabel = settings.showDayLabel !== false;\n    var showVisualMap = settings.showVisualMap !== false;\n    var showTooltip = settings.showTooltip !== false;\n\n    // Legend settings\n    var showLegend = settings.showLegend !== false;\n    var legendStyle = settings.legendStyle || 'classic';\n    var legendPosition = settings.legendPosition || 'bottom';\n    var legendAlign = settings.legendAlign || 'center';\n    var legendCardColorMode = settings.legendCardColorMode || 'auto';\n    var legendCardColor = settings.legendCardColor || '#2196F3';\n    var legendValues = settings.legendValues || ['current'];\n\n    // Timestamp settings\n    var showTimestamp = settings.showTimestamp !== false;\n    var timestampFormat = settings.timestampFormat || 'YYYY-MM-DD HH:mm:ss';\n\n    // Outlier removal settings\n    var removeOutliers = settings.removeOutliers === true;\n    var outlierMethod = settings.outlierMethod || 'iqr';\n    var outlierIqrMultiplier = settings.outlierIqrMultiplier || 1.5;\n    var outlierZscoreThreshold = settings.outlierZscoreThreshold || 3;\n    var outlierMinValue = settings.outlierMinValue;\n    var outlierMaxValue = settings.outlierMaxValue;\n\n    // Smoothing settings\n    var smoothingEnabled = settings.smoothingEnabled === true;\n    var smoothingWindowMinutes = settings.smoothingWindowMinutes || 15;\n\n    // Toolbox settings\n    var showToolbox = settings.showToolbox !== false;\n    var toolboxFeatures = settings.toolboxFeatures || ['saveAsImage', 'dataView', 'dataZoom', 'restore'];\n\n    // Timewindow selector settings\n    var showTimewindowSelector = settings.showTimewindowSelector === true;\n\n    // Initialize and render timewindow selector using library\n    if (showTimewindowSelector && self.ctx.dashboard && timewindowSelectorContainer) {\n        utils.timewindow.init(timewindowSelectorContainer, {\n            color: settings.twSelectorColor || '',\n            position: settings.twSelectorPosition || 'center',\n            dayFormat: settings.twSelectorDayFormat || 'D MMM YYYY',\n            weekFormat: settings.twSelectorWeekFormat || 'D-D MMM',\n            monthFormat: settings.twSelectorMonthFormat || 'MMM YYYY',\n            customStartTime: settings.twCustomStartTime || '',\n            customEndTime: settings.twCustomEndTime || '',\n            aggregationType: settings.twAggregationType || 'NONE',\n            maxDataPoints: settings.twMaxDataPoints || 100000\n        }, self.ctx);\n        utils.timewindow.render();\n    } else if (timewindowSelectorContainer) {\n        utils.timewindow.hide();\n    }\n\n    // Check for valid data\n    if (!data.length || !data[0].data || !data[0].data.length) {\n        showNoData('No data available');\n        return;\n    }\n\n    var valueData = data[0];\n    var dataKey = valueData.dataKey || {};\n    var label = dataKey.label || dataKey.name || 'Value';\n    var units = dataKey.units || '';\n    var decimals = dataKey.decimals !== undefined ? dataKey.decimals : 2;\n    var color = dataKey.color || utils.color.getDefault(0);\n\n    // Determine year to display\n    var displayYear;\n    if (yearDisplay === 'current') {\n        displayYear = new Date().getFullYear();\n    } else if (yearDisplay === 'previous') {\n        displayYear = new Date().getFullYear() - 1;\n    } else if (yearDisplay === 'custom') {\n        displayYear = customYear;\n    } else {\n        // Auto: use year from data\n        var firstTs = valueData.data[0][0];\n        displayYear = new Date(firstTs).getFullYear();\n    }\n\n    // Extract values and timestamps\n    var rawValues = [];\n    var timestamps = [];\n    for (var j = 0; j < valueData.data.length; j++) {\n        var ts = valueData.data[j][0];\n        var val = valueData.data[j][1];\n        if (val !== null && !isNaN(val)) {\n            timestamps.push(ts);\n            rawValues.push(val);\n        }\n    }\n\n    if (rawValues.length === 0) {\n        showNoData('No valid data points');\n        return;\n    }\n\n    var values = rawValues.slice();\n    var processedTimestamps = timestamps.slice();\n\n    // Remove outliers using library\n    if (removeOutliers) {\n        var outlierResult = utils.dataProcessing.removeOutliers(values, processedTimestamps, {\n            method: outlierMethod,\n            iqrMultiplier: outlierIqrMultiplier,\n            zscoreThreshold: outlierZscoreThreshold,\n            minValue: outlierMinValue,\n            maxValue: outlierMaxValue\n        });\n        values = outlierResult.values;\n        processedTimestamps = outlierResult.timestamps;\n        if (values.length === 0) {\n            showNoData('All data points removed by outlier filter');\n            return;\n        }\n    }\n\n    // Apply smoothing using library\n    if (smoothingEnabled && smoothingWindowMinutes > 0 && processedTimestamps.length > 1) {\n        var windowSize = utils.dataProcessing.getWindowSizeFromMinutes(processedTimestamps, smoothingWindowMinutes);\n        values = utils.dataProcessing.movingAverage(values, windowSize);\n    }\n\n    // Aggregate data by day\n    var dailyData = {};\n    for (var k = 0; k < values.length; k++) {\n        var dateKey = utils.format.timestamp(processedTimestamps[k], 'YYYY-MM-DD');\n        if (!dailyData[dateKey]) {\n            dailyData[dateKey] = { sum: 0, count: 0, lastTs: 0, lastVal: 0 };\n        }\n        dailyData[dateKey].sum += values[k];\n        dailyData[dateKey].count++;\n        if (processedTimestamps[k] > dailyData[dateKey].lastTs) {\n            dailyData[dateKey].lastTs = processedTimestamps[k];\n            dailyData[dateKey].lastVal = values[k];\n        }\n    }\n\n    // Build calendar data array\n    var calendarData = [];\n    var allDailyValues = [];\n    var lastTimestamp = null;\n    var lastValue = null;\n\n    Object.keys(dailyData).forEach(function(dateKey) {\n        var avg = dailyData[dateKey].sum / dailyData[dateKey].count;\n        calendarData.push([dateKey, avg]);\n        allDailyValues.push(avg);\n        if (dailyData[dateKey].lastTs > (lastTimestamp || 0)) {\n            lastTimestamp = dailyData[dateKey].lastTs;\n            lastValue = dailyData[dateKey].lastVal;\n        }\n    });\n\n    if (calendarData.length === 0) {\n        showNoData('No valid calendar data');\n        return;\n    }\n\n    // Calculate statistics using library\n    var stats = utils.stats.calculate(allDailyValues);\n    stats.current = lastValue;\n    stats.lastTimestamp = lastTimestamp;\n\n    var dataMin = stats.min;\n    var dataMax = stats.max;\n    var colorRange = getColorScheme(colorScheme, minColor, maxColor);\n\n    // Build toolbox config\n    var toolboxConfig = buildToolboxConfig(showToolbox, toolboxFeatures);\n\n    var option = {\n        tooltip: showTooltip ? {\n            formatter: function(params) {\n                return params.data[0] + '<br/>Value: ' + utils.format.value(params.data[1], decimals) + ' ' + units;\n            }\n        } : {},\n        toolbox: toolboxConfig,\n        visualMap: showVisualMap ? {\n            min: dataMin,\n            max: dataMax,\n            calculable: true,\n            orient: 'horizontal',\n            left: 'center',\n            bottom: 5,\n            inRange: {\n                color: colorRange\n            },\n            text: ['High', 'Low'],\n            textStyle: { fontSize: 10 }\n        } : {\n            show: false,\n            min: dataMin,\n            max: dataMax,\n            inRange: { color: colorRange }\n        },\n        calendar: {\n            top: showMonthLabel ? 40 : 20,\n            left: showDayLabel ? 50 : 30,\n            right: showToolbox ? 60 : 30,\n            bottom: showVisualMap ? 60 : 20,\n            cellSize: [cellSize, cellSize],\n            range: displayYear.toString(),\n            itemStyle: {\n                borderWidth: 0.5,\n                borderColor: '#fff'\n            },\n            yearLabel: { show: true, margin: 30 },\n            monthLabel: { show: showMonthLabel, fontSize: 10 },\n            dayLabel: { show: showDayLabel, fontSize: 10, firstDay: 1, nameMap: 'en' },\n            splitLine: {\n                show: true,\n                lineStyle: {\n                    color: '#ccc',\n                    width: 1\n                }\n            }\n        },\n        series: [{\n            type: 'heatmap',\n            coordinateSystem: 'calendar',\n            data: calendarData,\n            emphasis: {\n                itemStyle: {\n                    shadowBlur: 10,\n                    shadowColor: 'rgba(0, 0, 0, 0.5)'\n                }\n            }\n        }]\n    };\n\n    chart.setOption(option, true);\n\n    // Render statistics cards using library\n    var allStats = [{\n        label: label,\n        units: units,\n        decimals: decimals,\n        color: color,\n        stats: stats\n    }];\n\n    utils.statsCard.render(statsCardContainers, {\n        showLegend: showLegend,\n        legendStyle: legendStyle,\n        legendAlign: legendAlign,\n        legendCardColorMode: legendCardColorMode,\n        legendCardColor: legendCardColor,\n        legendValues: legendValues,\n        legendPosition: legendPosition,\n        showTimestamp: showTimestamp,\n        timestampFormat: timestampFormat,\n        allStats: allStats\n    });\n\n    // Resize chart after stats cards\n    function doResize() {\n        if (chart && chartContainer) {\n            chart.resize({\n                width: chartContainer.offsetWidth,\n                height: chartContainer.offsetHeight\n            });\n        }\n    }\n    requestAnimationFrame(function() { requestAnimationFrame(doResize); });\n    setTimeout(doResize, 100);\n    setTimeout(doResize, 250);\n}\n\nfunction showNoData(message) {\n    if (!chart) return;\n    chart.setOption({\n        title: {\n            text: message,\n            left: 'center',\n            top: 'middle',\n            textStyle: { color: '#999', fontSize: 14 }\n        }\n    }, true);\n}\n\nfunction buildToolboxConfig(showToolbox, toolboxFeatures) {\n    if (!showToolbox) return null;\n\n    var features = toolboxFeatures || [];\n    var toolbox = { show: true, right: 10, top: 5, feature: {} };\n\n    if (features.indexOf('saveAsImage') !== -1) {\n        toolbox.feature.saveAsImage = { show: true, title: 'Save as PNG', pixelRatio: 2 };\n    }\n\n    if (features.indexOf('dataView') !== -1) {\n        toolbox.feature.dataView = {\n            show: true,\n            title: 'Data View',\n            readOnly: true,\n            lang: ['Data View', 'Close', 'Refresh']\n        };\n    }\n\n    if (features.indexOf('dataZoom') !== -1) {\n        toolbox.feature.dataZoom = { show: true, title: { zoom: 'Zoom', back: 'Reset Zoom' } };\n    }\n\n    if (features.indexOf('restore') !== -1) {\n        toolbox.feature.restore = { show: true, title: 'Restore' };\n    }\n\n    return toolbox;\n}\n\nself.onResize = function() {\n    if (chart && chartContainer) {\n        chart.resize({\n            width: chartContainer.offsetWidth,\n            height: chartContainer.offsetHeight\n        });\n    }\n};\n\nself.onDestroy = function() {\n    if (resizeObserver) {\n        resizeObserver.disconnect();\n        resizeObserver = null;\n    }\n    if (chart) {\n        chart.dispose();\n        chart = null;\n    }\n};\n\nself.typeParameters = function() {\n    return {\n        previewWidth: '100%',\n        previewHeight: '100%',\n        embedTitlePanel: false,\n        hasDataExportAction: true,\n        hasAdditionalLatestDataKeys: true,\n        defaultDataKeysFunction: function() {\n            return [{\n                name: 'value',\n                label: 'Daily Value',\n                type: 'timeseries',\n                units: '',\n                decimals: 1\n            }];\n        }\n    };\n};\n",
    "settingsSchema": {
      "schema": {
        "type": "object",
        "title": "Calendar Heatmap Settings",
        "properties": {
          "yearDisplay": {
            "title": "Year Display",
            "type": "string",
            "default": "auto",
            "enum": [
              "auto",
              "current",
              "previous",
              "custom"
            ]
          },
          "customYear": {
            "title": "Custom Year",
            "type": "number",
            "default": 2024
          },
          "colorScheme": {
            "title": "Color Scheme",
            "type": "string",
            "default": "github",
            "enum": [
              "github",
              "blue",
              "green",
              "red",
              "purple",
              "custom"
            ]
          },
          "minColor": {
            "title": "Min Color (custom)",
            "type": "string",
            "default": "#ebedf0"
          },
          "maxColor": {
            "title": "Max Color (custom)",
            "type": "string",
            "default": "#216e39"
          },
          "cellSize": {
            "title": "Cell Size (px)",
            "type": "number",
            "default": 14,
            "minimum": 8,
            "maximum": 30
          },
          "showMonthLabel": {
            "title": "Show Month Labels",
            "type": "boolean",
            "default": true
          },
          "showDayLabel": {
            "title": "Show Day Labels",
            "type": "boolean",
            "default": true
          },
          "showVisualMap": {
            "title": "Show Color Legend",
            "type": "boolean",
            "default": true
          },
          "showTooltip": {
            "title": "Show Tooltip",
            "type": "boolean",
            "default": true
          },
          "showTimewindowSelector": {
            "title": "Show Timewindow Selector",
            "type": "boolean",
            "default": false
          },
          "twSelectorColor": {
            "title": "Selector Color",
            "type": "string",
            "default": ""
          },
          "twSelectorPosition": {
            "title": "Selector Position",
            "type": "string",
            "default": "center",
            "enum": [
              "left",
              "center",
              "right"
            ]
          },
          "twSelectorDayFormat": {
            "title": "Day Format",
            "type": "string",
            "default": "D MMM YYYY"
          },
          "twSelectorWeekFormat": {
            "title": "Week Format",
            "type": "string",
            "default": "D-D MMM"
          },
          "twSelectorMonthFormat": {
            "title": "Month Format",
            "type": "string",
            "default": "MMM YYYY"
          },
          "twCustomStartTime": {
            "title": "Custom Start Time",
            "type": "string",
            "default": ""
          },
          "twCustomEndTime": {
            "title": "Custom End Time",
            "type": "string",
            "default": ""
          },
          "twAggregationType": {
            "title": "Aggregation",
            "type": "string",
            "default": "NONE",
            "enum": [
              "NONE",
              "AVG",
              "MIN",
              "MAX",
              "SUM",
              "COUNT"
            ]
          },
          "twMaxDataPoints": {
            "title": "Max Data Points",
            "type": "number",
            "default": 100000
          },
          "showLegend": {
            "title": "Show Legend",
            "type": "boolean",
            "default": true
          },
          "legendStyle": {
            "title": "Legend Style",
            "type": "string",
            "default": "classic",
            "enum": [
              "classic",
              "card"
            ]
          },
          "legendPosition": {
            "title": "Legend Position",
            "type": "string",
            "default": "bottom",
            "enum": [
              "top",
              "bottom",
              "left",
              "right"
            ]
          },
          "legendAlign": {
            "title": "Legend Alignment",
            "type": "string",
            "default": "center",
            "enum": [
              "left",
              "center",
              "right"
            ]
          },
          "legendCardColorMode": {
            "title": "Card Color Mode",
            "type": "string",
            "default": "auto",
            "enum": [
              "auto",
              "manual",
              "gradient"
            ]
          },
          "legendCardColor": {
            "title": "Card Color",
            "type": "string",
            "default": "#2196F3"
          },
          "legendValues": {
            "title": "Statistics to Display",
            "type": "array",
            "items": {
              "type": "string"
            },
            "default": [
              "current"
            ]
          },
          "showTimestamp": {
            "title": "Show Timestamp",
            "type": "boolean",
            "default": true
          },
          "timestampFormat": {
            "title": "Timestamp Format",
            "type": "string",
            "default": "YYYY-MM-DD HH:mm:ss"
          },
          "removeOutliers": {
            "title": "Remove Outliers",
            "type": "boolean",
            "default": false
          },
          "outlierMethod": {
            "title": "Outlier Method",
            "type": "string",
            "default": "iqr",
            "enum": [
              "iqr",
              "zscore",
              "manual"
            ]
          },
          "outlierIqrMultiplier": {
            "title": "IQR Multiplier",
            "type": "number",
            "default": 1.5
          },
          "outlierZscoreThreshold": {
            "title": "Z-Score Threshold",
            "type": "number",
            "default": 3
          },
          "outlierMinValue": {
            "title": "Minimum Value",
            "type": "number"
          },
          "outlierMaxValue": {
            "title": "Maximum Value",
            "type": "number"
          },
          "smoothingEnabled": {
            "title": "Enable Smoothing",
            "type": "boolean",
            "default": false
          },
          "smoothingWindowMinutes": {
            "title": "Smoothing Window (minutes)",
            "type": "number",
            "default": 15
          },
          "showToolbox": {
            "title": "Show Toolbox",
            "type": "boolean",
            "default": true
          },
          "toolboxFeatures": {
            "title": "Toolbox Features",
            "type": "array",
            "items": {
              "type": "string"
            },
            "default": [
              "saveAsImage",
              "dataView",
              "dataZoom",
              "restore"
            ]
          }
        },
        "required": []
      },
      "form": [
        [
          {
            "key": "yearDisplay",
            "type": "rc-select",
            "multiple": false,
            "items": [
              {
                "value": "auto",
                "label": "Auto (from data)"
              },
              {
                "value": "current",
                "label": "Current year"
              },
              {
                "value": "previous",
                "label": "Previous year"
              },
              {
                "value": "custom",
                "label": "Custom year"
              }
            ]
          },
          {
            "key": "customYear",
            "condition": "model.yearDisplay === 'custom'"
          },
          {
            "key": "colorScheme",
            "type": "rc-select",
            "multiple": false,
            "items": [
              {
                "value": "github",
                "label": "GitHub style (green)"
              },
              {
                "value": "blue",
                "label": "Blue gradient"
              },
              {
                "value": "green",
                "label": "Green gradient"
              },
              {
                "value": "red",
                "label": "Red gradient"
              },
              {
                "value": "purple",
                "label": "Purple gradient"
              },
              {
                "value": "custom",
                "label": "Custom colors"
              }
            ]
          },
          {
            "key": "minColor",
            "type": "color",
            "condition": "model.colorScheme === 'custom'"
          },
          {
            "key": "maxColor",
            "type": "color",
            "condition": "model.colorScheme === 'custom'"
          },
          "cellSize",
          "showMonthLabel",
          "showDayLabel",
          "showVisualMap",
          "showTooltip"
        ],
        [
          "showLegend",
          {
            "key": "legendStyle",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showLegend === true",
            "items": [
              {
                "value": "classic",
                "label": "Classic (Text)"
              },
              {
                "value": "card",
                "label": "Statistics Card"
              }
            ]
          },
          {
            "key": "legendPosition",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showLegend === true",
            "items": [
              {
                "value": "top",
                "label": "Top"
              },
              {
                "value": "bottom",
                "label": "Bottom"
              },
              {
                "value": "left",
                "label": "Left"
              },
              {
                "value": "right",
                "label": "Right"
              }
            ]
          },
          {
            "key": "legendAlign",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showLegend === true && model.legendStyle === 'card'",
            "items": [
              {
                "value": "left",
                "label": "Left"
              },
              {
                "value": "center",
                "label": "Center"
              },
              {
                "value": "right",
                "label": "Right"
              }
            ]
          },
          {
            "key": "legendCardColorMode",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showLegend === true && model.legendStyle === 'card'",
            "items": [
              {
                "value": "auto",
                "label": "Auto (Series Color)"
              },
              {
                "value": "manual",
                "label": "Manual Color"
              },
              {
                "value": "gradient",
                "label": "Gradient"
              }
            ]
          },
          {
            "key": "legendCardColor",
            "type": "color",
            "condition": "model.showLegend === true && model.legendStyle === 'card' && model.legendCardColorMode === 'manual'"
          },
          {
            "key": "legendValues",
            "type": "rc-select",
            "multiple": true,
            "condition": "model.showLegend === true && model.legendStyle === 'card'",
            "items": [
              {
                "value": "current",
                "label": "Current Value"
              },
              {
                "value": "min",
                "label": "Minimum"
              },
              {
                "value": "max",
                "label": "Maximum"
              },
              {
                "value": "mean",
                "label": "Mean"
              },
              {
                "value": "median",
                "label": "Median"
              },
              {
                "value": "sum",
                "label": "Sum"
              },
              {
                "value": "count",
                "label": "Count"
              }
            ]
          },
          {
            "key": "showTimestamp",
            "condition": "model.showLegend === true && model.legendStyle === 'card'"
          },
          {
            "key": "timestampFormat",
            "condition": "model.showLegend === true && model.legendStyle === 'card' && model.showTimestamp === true"
          }
        ],
        [
          "removeOutliers",
          {
            "key": "outlierMethod",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.removeOutliers === true",
            "items": [
              {
                "value": "iqr",
                "label": "IQR (Interquartile Range)"
              },
              {
                "value": "zscore",
                "label": "Z-Score"
              },
              {
                "value": "manual",
                "label": "Manual Thresholds"
              }
            ]
          },
          {
            "key": "outlierIqrMultiplier",
            "condition": "model.removeOutliers === true && model.outlierMethod === 'iqr'"
          },
          {
            "key": "outlierZscoreThreshold",
            "condition": "model.removeOutliers === true && model.outlierMethod === 'zscore'"
          },
          {
            "key": "outlierMinValue",
            "condition": "model.removeOutliers === true && model.outlierMethod === 'manual'"
          },
          {
            "key": "outlierMaxValue",
            "condition": "model.removeOutliers === true && model.outlierMethod === 'manual'"
          },
          "smoothingEnabled",
          {
            "key": "smoothingWindowMinutes",
            "condition": "model.smoothingEnabled === true"
          }
        ],
        [
          "showToolbox",
          {
            "key": "toolboxFeatures",
            "type": "rc-select",
            "multiple": true,
            "condition": "model.showToolbox === true",
            "items": [
              {
                "value": "saveAsImage",
                "label": "Save as Image"
              },
              {
                "value": "dataView",
                "label": "Data View"
              },
              {
                "value": "dataZoom",
                "label": "Data Zoom"
              },
              {
                "value": "restore",
                "label": "Restore"
              }
            ]
          }
        ],
        [
          "showTimewindowSelector",
          {
            "key": "twSelectorColor",
            "type": "color",
            "condition": "model.showTimewindowSelector === true",
            "description": "Leave empty for auto (uses series color)"
          },
          {
            "key": "twSelectorPosition",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showTimewindowSelector === true",
            "items": [
              {
                "value": "left",
                "label": "Left"
              },
              {
                "value": "center",
                "label": "Center"
              },
              {
                "value": "right",
                "label": "Right"
              }
            ]
          },
          {
            "key": "twSelectorDayFormat",
            "condition": "model.showTimewindowSelector === true",
            "description": "Format: D=day, DD=day(2), MMM=month, MM=month(2), YYYY=year, YY=year(2)"
          },
          {
            "key": "twSelectorWeekFormat",
            "condition": "model.showTimewindowSelector === true"
          },
          {
            "key": "twSelectorMonthFormat",
            "condition": "model.showTimewindowSelector === true"
          },
          {
            "key": "twCustomStartTime",
            "condition": "model.showTimewindowSelector === true",
            "description": "Use ${attributeName} for entity attributes, e.g. ${startTimeMs}"
          },
          {
            "key": "twCustomEndTime",
            "condition": "model.showTimewindowSelector === true",
            "description": "Use ${attributeName} for entity attributes, e.g. ${endTimeMs}"
          },
          {
            "key": "twAggregationType",
            "type": "rc-select",
            "multiple": false,
            "condition": "model.showTimewindowSelector === true",
            "items": [
              {
                "value": "NONE",
                "label": "None (Raw Data)"
              },
              {
                "value": "AVG",
                "label": "Average"
              },
              {
                "value": "MIN",
                "label": "Minimum"
              },
              {
                "value": "MAX",
                "label": "Maximum"
              },
              {
                "value": "SUM",
                "label": "Sum"
              },
              {
                "value": "COUNT",
                "label": "Count"
              }
            ]
          },
          {
            "key": "twMaxDataPoints",
            "condition": "model.showTimewindowSelector === true",
            "description": "Maximum number of data points to fetch (default: 100000)"
          }
        ]
      ],
      "groupInfoes": [
        {
          "formIndex": 0,
          "GroupTitle": "Chart Settings"
        },
        {
          "formIndex": 1,
          "GroupTitle": "Legend Settings"
        },
        {
          "formIndex": 2,
          "GroupTitle": "Data Processing"
        },
        {
          "formIndex": 3,
          "GroupTitle": "Toolbox Settings"
        },
        {
          "formIndex": 4,
          "GroupTitle": "Timewindow Selector"
        }
      ]
    },
    "dataKeySettingsSchema": {},
    "latestDataKeySettingsSchema": {},
    "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Daily Activity\",\"color\":\"#40c463\",\"settings\":{},\"_hash\":0.1,\"funcBody\":\"var dayOfYear = Math.floor((time - new Date(new Date(time).getFullYear(), 0, 0)) / 86400000);\\nvar weekday = new Date(time).getDay();\\nvar base = Math.sin(dayOfYear / 365 * Math.PI * 4) * 5 + 10;\\nvar weekendBonus = (weekday === 0 || weekday === 6) ? -3 : 2;\\nreturn Math.max(0, base + weekendBonus + Math.random() * 8);\",\"units\":\"commits\",\"decimals\":0}]}],\"timewindow\":{\"hideInterval\":false,\"hideLastInterval\":false,\"hideQuickInterval\":false,\"hideAggregation\":false,\"hideAggInterval\":false,\"hideTimezone\":false,\"selectedTab\":1,\"history\":{\"historyType\":2,\"timewindowMs\":31536000000,\"interval\":86400000,\"fixedTimewindow\":{\"startTimeMs\":0,\"endTimeMs\":0}},\"aggregation\":{\"type\":\"AVG\",\"limit\":25000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"yearDisplay\":\"auto\",\"colorScheme\":\"github\",\"cellSize\":14,\"showMonthLabel\":true,\"showDayLabel\":true,\"showVisualMap\":true,\"showTooltip\":true,\"showLegend\":true,\"legendStyle\":\"classic\",\"legendPosition\":\"bottom\",\"legendAlign\":\"center\",\"legendCardColorMode\":\"auto\",\"legendCardColor\":\"#2196F3\",\"legendValues\":[\"current\"],\"showTimestamp\":true,\"timestampFormat\":\"YYYY-MM-DD HH:mm:ss\",\"showToolbox\":true,\"toolboxFeatures\":[\"saveAsImage\",\"dataView\",\"dataZoom\",\"restore\"]},\"title\":\"Calendar Heatmap\",\"dropShadow\":true,\"enableFullscreen\":true,\"useDashboardTimewindow\":true,\"displayTimewindow\":true,\"hasAdditionalLatestDataKeys\":true}"
  },
  "tags": [
    "chart",
    "timeseries",
    "calendar",
    "heatmap",
    "github",
    "daily",
    "annual",
    "echarts"
  ]
}